# 支付宝开放平台密钥生成与配置指南

## 1. 密钥的角色与重要性

在与支付宝开放平台进行接口交互时，为了保证通信的安全、可靠和不可篡改，采用了基于 **非对称加密（RSA2）** 的签名和验签机制。这套机制依赖于一对密钥：

- **应用私钥 (App Private Key)**：由自己生成和保管，绝对不能泄露。它用于给支付宝的请求数据进行 **签名**，证明这个请求确实是本方发出的。
- **应用公钥 (App Public Key)**：由自己生成，需要上传到支付宝开放平台。支付宝会使用这个公钥来 **验证** 请求的签名是否正确。
- **支付宝公钥 (Alipay Public Key)**：由支付宝平台提供。当支付宝给您发送异步通知时，需要用这个公钥来 **验证** 该通知是否真的来自支付宝，而不是伪造的。

>  **私钥签名，公钥验签**。您用自己的私钥签名，支付宝用您的公钥验签；支付宝用它的私钥签名，您用它的公钥验签。

## 2. 生成密钥对（使用官方工具）

获取密钥最推荐的方式是使用“支付宝开放平台开发助手”。

### 步骤 1：下载并打开工具

- 访问 [支付宝开放平台文档中心](https://opendocs.alipay.com/common/02kipl) 下载与您操作系统匹配的 **开放平台开发助手**。
- 解压并运行该工具。

### 步骤 2：生成密钥

1. 打开开发助手后，通常会默认进入密钥生成界面。
2. **密钥模式**：选择 **PKCS1(非JAVA适用)**。即使您使用Java，选择此格式生成的密钥也是通用的，后续可以转换为PKCS8。
3. **密钥长度**：务必选择 **RSA2**，对应的长度是 **2048位**。
4. 点击 **“生成密钥”** 按钮。

工具会自动在下方生成两段文本：**应用私钥** 和 **应用公钥**。

- **应用私钥**：请务必点击“**保存私钥**”按钮，将其保存为 `app_private_key.pem` 文件，并存放在项目的安全位置。**这段密钥绝不能对外暴露。**
- **应用公钥**：点击“**复制公钥**”按钮，准备用于下一步的配置。

## 3. 在支付宝开放平台配置公钥

### 步骤 1：进入应用配置页

- 登录 [支付宝开放平台](https://open.alipay.com/)，进入“开发者中心”。
- 选择“**沙箱**”或“**网页&移动应用**”中要配置的应用，点击进入。

### 步骤 2：设置应用公钥

1. 在应用详情页左侧导航栏找到 “**开发设置**”。
2. 在 “**接口加签方式**” 设置区域，点击 “**设置**” 或 “**修改**”。
3. **加签模式**：选择 “**公钥**”。
4. **签名算法**：选择 “**RSA2**”。
5. 将上一步从工具中复制的 **应用公钥** 字符串完整地粘贴到文本框中。
6. 点击 **“保存”**。

### 步骤 3：获取支付宝公钥

当成功保存应用公钥后，页面上会显示出对应的 **支付宝公钥**。请点击 **“复制”** 并妥善保管。可以将其保存为 `alipay_public_key.pem` 文件，或者直接用于代码配置。

## 4. 在项目中使用密钥

1. **应用私钥 (`app_private_key.pem`)**：
   - 在 **Java (Spring Boot)** 项目中，通常是将其完整的字符串（不含`-----BEGIN/END-----`头尾）配置在 `application.properties` 中。
   - 在 **Python (Flask)** 项目中，通常是通过文件路径读取 `app_private_key.pem` 文件的内容。
2. **支付宝公钥 (`alipay_public_key.pem`)**：
   - 与应用私钥类似，根据使用的SDK，可以配置其文件路径或完整的字符串内容。

**总结：**

- **您自己生成的**：`应用私钥` (保密) 和 `应用公钥` (上传)。
- **支付宝提供的**：`支付宝公钥` (复制下来使用)。

请确保在配置时，私钥和公钥没有弄混，并且复制的内容完整、无空格、无换行符。