# 第三方登录集成总览 (OAuth 2.0)

## 1. 简介

本文档是第三方登录功能模块的总览，旨在提供一个统一的视角来理解不同平台（如 GitHub, 支付宝, 微信等）登录的通用原理和核心流程。所有第三方登录都基于 **OAuth 2.0** 授权框架，这是一个关于授权的开放网络标准。

**核心目标**：让用户能够使用他们已有的第三方平台账户，安全、便捷地登录我们的应用，而无需在我们这里创建新的用户名和密码。

## 2. 核心概念

理解 OAuth 2.0 中的几个关键角色至关重要：

- **资源所有者 (Resource Owner)**: 即你的**用户**，他们拥有在第三方平台上的数据（如昵称、头像）。
- **客户端 (Client)**: 即你的**应用程序**（网站或App），希望访问用户在第三方平台上的信息。
- **授权服务器 (Authorization Server)**: 第三方平台提供的服务（如 `github.com`），负责验证用户身份并提供授权许可。
- **资源服务器 (Resource Server)**: 第三方平台提供的服务，负责存储用户信息，并提供API供客户端在获得授权后访问。

## 3. 通用授权流程 (授权码模式)

无论是GitHub还是支付宝，它们都遵循一个非常相似的“授权码 (Authorization Code)”模式流程。这个流程可以分解为以下几个关键步骤：

*图片来源: RFC 6749*

1. **用户发起登录请求**:
   - 用户在你的网站上点击“使用XX登录”按钮。
2. **客户端重定向到授权服务器**:
   - 你的前端将页面重定向到第三方平台的授权页面。
   - 重定向的 URL 中必须携带几个关键参数：
     - `client_id`: 你的应用在第三方平台注册后获得的唯一ID。
     - `redirect_uri`: 用户在第三方平台授权后，浏览器需要跳回的你的后端API地址。
     - `response_type=code`: 表明你希望获取一个**授权码 (code)**。
     - `scope`: 你希望从用户那里获得哪些信息的权限范围（如 `user:email`）。
     - `state`: 一个随机生成的字符串，用于防止CSRF攻击，后续需要验证。
3. **用户授权**:
   - 用户在第三方平台的页面上输入账号密码，并同意授权你的应用访问其指定信息。
4. **授权服务器返回授权码**:
   - 授权成功后，第三方平台会将页面重定向回你在第2步中指定的 `redirect_uri`。
   - 在回调的 URL 参数中，会附带一个临时的**授权码 (code)** 和之前发送的 `state` 值。
5. **客户端后台用授权码换取访问令牌 (Access Token)**:
   - 你的**后端服务**收到这个 `code` 后，立即向第三方平台的另一个API端点发起一个 **POST** 请求。
   - 这个请求需要携带 `code`、`client_id` 和 `client_secret`（你的应用密钥，**绝不能暴露在前端**）。
   - 验证通过后，第三方平台会返回一个 **`access_token`**。这个令牌是后续访问用户信息的钥匙。
6. **客户端后台用访问令牌获取用户信息**:
   - 你的后端服务使用上一步获取的 `access_token`，向第三方平台的资源服务器（如 "Get User Info" API）发起请求。
   - 资源服务器验证 `access_token` 的有效性，并返回用户的基本信息（如用户ID、昵称、头像等）。
7. **完成登录流程**:
   - 你的后端服务根据获取到的第三方用户ID，判断该用户是否已在你的系统中注册。
     - **如果已注册**：直接为该用户生成你系统自己的登录凭证（如 JWT Token），并返回给前端，完成登录。
     - **如果未注册**：为该用户在你的数据库中创建一个新账户，并绑定第三方信息，然后生成登录凭证返回给前端。

## 4. 具体实现指南

根据以上通用流程，我们为每个平台提供了详细的实现教程。请根据需要查阅：

- **[GitHub 登录集成教程](./GitHub_Login.md)**
  - 适用于Web端，流程标准，是理解OAuth 2.0的最佳实践案例。
- **[支付宝沙箱登录集成教程](../alipay-sandbox/alipay-third-party-login-guide.md)**
  - 流程类似，但在密钥生成、签名和API调用细节上有所不同，特别适合涉及支付和用户信息安全的场景。